{"version":3,"sources":["views/objectstore/ManageStore.jsx","views/objectstore/index.js","../node_modules/@mui/icons-material/Add.js","services/StorageConf.jsx","../node_modules/@mui/icons-material/FileDownload.js"],"names":["ManageStore","useState","rows","setData","ownbucket","setownbucket","bucketname","setbucketname","useEffect","getstorageapi","config","rootapi","UserService","getUsername","axios","get","then","res","data","map","item","item_name","name","getBuckets","catch","err","console","log","targetValue","fileObj","stream","DpzStorageConf","listObjects","on","obj","push","newData","JSON","parse","stringify","lastModified","Date","toLocaleString","size","e","options","filter","print","selectableRows","responsive","textLabels","customToolbarSelect","selectedRows","Tooltip","title","IconButton","onClick","getObject","dataIndex","deleteObjects","curent_bucketName","a","removeObject","presignedGetObject","presignedUrl","window","location","href","navigate","useNavigate","Select","id","value","onChange","event","target","MenuItem","Button","columns","label","Objectstorepage","_interopRequireDefault","require","Object","defineProperty","exports","default","_createSvgIcon","_jsxRuntime","_default","jsx","d","minio","endPoint","useSSL","port","accessKey","secretKey"],"mappings":"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","file":"static/js/9.4af41504.chunk.js","sourcesContent":["import { useState, useEffect } from 'react'\r\nimport MUIDataTable from \"mui-datatables\";\r\nimport config from \"../../config\";\r\nimport AddIcon from '@mui/icons-material/Add';\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport Button from '@mui/material/Button';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport FileDownloadIcon from '@mui/icons-material/FileDownload';\r\nimport axios from 'axios';\r\nimport { Tooltip, IconButton } from '@mui/material';\r\nimport UserService from 'services/UserService';\r\nimport { Select } from '@mui/material';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport DpzStorageConf from 'services/StorageConf';\r\n\r\n\r\n\r\nexport default function ManageStore() {\r\n    const [rows, setData] = useState([]);\r\n    const [ownbucket, setownbucket] = useState([]);\r\n    const [bucketname, setbucketname] = useState(\"\");\r\n\r\n    useEffect(() => {\r\n        const getstorageapi = config.rootapi + '/invoice/usernamentype/' + UserService.getUsername() + '&storage';\r\n\r\n        axios.get(getstorageapi)\r\n            .then(res => {\r\n                let data = res.data.data.map(item => {\r\n                    return {\r\n                        'id': item.item_name, 'name': item.item_name\r\n                    }\r\n                })\r\n                setownbucket(data)\r\n                setbucketname(data[0].name)\r\n                getBuckets(data[0].name)\r\n            }).catch(err => { console.log(err) })\r\n    }, []);\r\n\r\n\r\n    const onInputChanged = (event) => {\r\n        const targetValue = event.target.value;\r\n        getBuckets(targetValue);\r\n        setbucketname(targetValue);\r\n\r\n    };\r\n  \r\n\r\n\r\n    const getBuckets = (targetValue) => {\r\n        // create the client\r\n\r\n        const fileObj = []\r\n        // const mc = new minio.Client({\r\n        //     endPoint: config.storageapi,\r\n        //     useSSL: true,\r\n        //     accessKey: \"s2l92I0TXj01BOGP\",\r\n        //     secretKey: \"Q25hRHG13VxoKPrFmgLuXMDOi3WFOLFk\"\r\n        // });\r\n\r\n        try {\r\n            const stream = DpzStorageConf.listObjects(targetValue, '', true);\r\n\r\n            stream.on('data', function (obj) { fileObj.push(obj) });\r\n            stream.on(\"end\", function () {\r\n                let data = JSON.parse(JSON.stringify(fileObj))\r\n                let newData = data.map(item => {\r\n                    let lastModified = new Date(Date.parse(item.lastModified)).toLocaleString()\r\n\r\n                    return {\r\n                        'etag': item.item,\r\n                        'lastModified': lastModified,\r\n                        'name': item.name,\r\n                        'size': item.size\r\n                    }\r\n                })\r\n                // data.lastModified = data.lastModified.map(item =>{\r\n                //     return new Date(Date.parse(item)).toLocaleString()\r\n                // })\r\n                setData(newData);\r\n            });\r\n            stream.on('error', function (err) { console.log(err) });\r\n\r\n        }\r\n        catch (e) {\r\n            console.log(e)\r\n        }\r\n\r\n    };\r\n\r\n    const columns = [\r\n        {\r\n            name: \"name\",\r\n            options: {\r\n                filter: true\r\n            },\r\n            label: 'Tên tệp'\r\n        },\r\n        {\r\n            name: \"size\",\r\n            options: {\r\n                filter: true\r\n            },\r\n            label: 'Dung lượng tệp',\r\n        },\r\n        {\r\n            name: \"lastModified\",\r\n            options: {\r\n                filter: false\r\n            },\r\n            label: 'Ngày tạo'\r\n        }\r\n\r\n    ];\r\n\r\n\r\n\r\n\r\n\r\n    const options = {\r\n        filter: false,\r\n        print: false,\r\n        selectableRows: \"single\",\r\n        responsive: \"standard\",\r\n        textLabels: {},\r\n        customToolbarSelect: selectedRows => (\r\n            <>\r\n                <Tooltip title=\"Tải về\">\r\n                    <IconButton\r\n                        onClick={() => {\r\n                            getObject(bucketname, rows[selectedRows.data[0].dataIndex]['name'])\r\n                          \r\n\r\n                        }}\r\n\r\n                    >\r\n                        <FileDownloadIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n\r\n                <Tooltip title=\"Xoá\">\r\n                    <IconButton\r\n                        onClick={() => {\r\n                            deleteObjects(bucketname, rows[selectedRows.data[0].dataIndex]['name'])\r\n                           \r\n\r\n                        }}\r\n\r\n                    >\r\n                        <DeleteIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n\r\n            </>\r\n\r\n        )\r\n    };\r\n\r\n    const deleteObjects = async (curent_bucketName, obj) => {\r\n\r\n\r\n        if (obj) {\r\n\r\n            try {\r\n                DpzStorageConf.removeObject(curent_bucketName, obj, function (err) {\r\n                    if (err) {\r\n                        return console.log('Unable to remove object', err)\r\n                    }\r\n                    console.log('Removed the object')\r\n                    getBuckets(curent_bucketName);\r\n                });\r\n            } catch (e) {\r\n                console.log(e)\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    const getObject = async (curent_bucketName, obj) => {\r\n\r\n\r\n        if (obj) {\r\n\r\n            try {\r\n                DpzStorageConf.presignedGetObject(curent_bucketName, obj, 24 * 60 * 60, function (err, presignedUrl) {\r\n                    if (err) return console.log(err)\r\n                    console.log(presignedUrl)\r\n                    window.location.href = presignedUrl\r\n\r\n                })\r\n            } catch (e) {\r\n                console.log(e)\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    const navigate = useNavigate()\r\n\r\n    const onClickHandler = () => navigate('/objectstore/uploadmultifile');\r\n\r\n \r\n\r\n\r\n    return (\r\n        <div><strong>Danh sách thư mục : </strong>\r\n            <Select id=\"listbucket\" \r\n            name='listbucket'\r\n            value={bucketname} \r\n            // defaultValue={ownbucket[0]?.name}\r\n            onChange={onInputChanged}\r\n            size=\"small\"\r\n            >\r\n\r\n                {ownbucket.map((item) => (\r\n                    <MenuItem\r\n                        key={item.id}\r\n                        value={item.name}\r\n                    >\r\n                        {item.name}\r\n                    </MenuItem>\r\n                ))}\r\n\r\n            </Select>\r\n            <Button onClick={onClickHandler} > {<AddIcon />} Tải lên</Button>\r\n            {/* <Button   > {<ModeEditIcon/>} Tải xuống</Button>\r\n                <Button   > {<ModeEditIcon/>} Xoá</Button> */}\r\n            <MUIDataTable\r\n                title={\"Danh sách tệp tin\"}\r\n                data={rows}\r\n                columns={columns}\r\n                options={options}\r\n            />\r\n\r\n        </div>\r\n\r\n    )\r\n\r\n}\r\n\r\n\r\n\r\n","import ManageStore from './ManageStore';\r\n\r\n\r\nconst Objectstorepage = () => (\r\n   <ManageStore></ManageStore>\r\n\r\n    // <UploadMultiFiles></UploadMultiFiles>\r\n);\r\n\r\nexport default Objectstorepage;\r\n","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _jsxRuntime = require(\"react/jsx-runtime\");\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\"\n}), 'Add');\n\nexports.default = _default;","import * as minio from \"minio\";\r\nconst DpzStorageConf = new minio.Client(\r\n   \r\n    {\r\n            endPoint: \"apilakedpa.apps.xplat.fis.com.vn\",\r\n            useSSL: true,\r\n            port: 443,\r\n            accessKey: \"naQrl3yAjoue8o22\",\r\n            secretKey: \"A0d6ZmTAbcVrhgTorNzCFBddtAWUjruP\"\r\n    }\r\n);\r\nexport default DpzStorageConf","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _jsxRuntime = require(\"react/jsx-runtime\");\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z\"\n}), 'FileDownload');\n\nexports.default = _default;"],"sourceRoot":""}